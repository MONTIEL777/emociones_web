<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estad√≠sticas de Emociones</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-r from-gray-800 to-teal-500 text-white min-h-screen flex flex-col items-center justify-center p-8">

    <div class="bg-white bg-opacity-10 p-6 rounded-lg shadow-lg w-full max-w-3xl">
        <h1 class="text-2xl font-bold text-center mb-4">üìä Tus Estad√≠sticas Emocionales</h1>

        <!-- Selector de Filtro -->
        <form method="get" action="{{ url_for('estadisticas') }}" class="mb-6 flex justify-center">
<label for="filtro" class="mr-3 text-lg font-bold text-white bg-gradient-to-r from-teal-400 to-cyan-600 px-3 py-1 rounded-full shadow-md">
    üîç Filtrar por:
</label>
            <select name="filtro" id="filtro" onchange="this.form.submit()"
            class="bg-white text-gray-800 font-semibold px-4 py-2 rounded-lg shadow-lg border border-gray-300 hover:border-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-400 transition duration-200 ease-in-out">
            <option value="dia" {% if filtro == 'dia' %}selected{% endif %}>üìÖ Hoy</option>
            <option value="semana" {% if filtro == 'semana' %}selected{% endif %}>üóì √öltimos 7 d√≠as</option>
            <option value="15dias" {% if filtro == '15dias' %}selected{% endif %}>üóì √öltimos 15 d√≠as</option>
            <option value="mes" {% if filtro == 'mes' %}selected{% endif %}>üìÜ √öltimos 30 d√≠as</option>
        </select>
        
        </form>

        <!-- Gr√°fica -->
        <canvas id="emocionesChart" class="mb-6"></canvas>

        <a href="{{ url_for('detectar') }}" class="bg-gradient-to-r from-red-500 to-teal-500 text-white py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">üè† Volver al Inicio</a>
    </div>

    <script>
        try {
            const emociones = JSON.parse('{{ emociones | tojson | safe }}');
            const totales = JSON.parse('{{ totales | tojson | safe }}');
    
            if (emociones.length === 0 || totales.length === 0) {
                console.warn("No hay datos para mostrar en la gr√°fica.");
            } else {
                const ctx = document.getElementById('emocionesChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: emociones,
                        datasets: [{
                            label: 'Cantidad de veces detectada',
                            data: totales,
                            backgroundColor: [
                                '#f87171', '#34d399', '#60a5fa', '#fbbf24', '#a78bfa', '#f472b6'
                            ],
                            borderColor: '#fff',
                            borderWidth: 2,
                            borderRadius: 6,
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: 'white' }
                            },
                            x: {
                                ticks: { color: 'white' }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: { color: 'white' }
                            },
                            title: {
                                display: true,
                                text: 'Frecuencia de Emociones Detectadas',
                                color: 'white',
                                font: { size: 18 }
                            }
                        }
                    }
                });
            }
        } catch (e) {
            console.error("Error al generar la gr√°fica:", e);
        }
    </script>
    
</body>
</html>
